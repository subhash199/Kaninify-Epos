@page "/backoffice"
@inject NavigationManager NavigationManager
@inject DataHandlerLibrary.Interfaces.IPrinterService PrinterService
@inject DataHandlerLibrary.Services.DrawerLogServices DrawerLogService
@inject EposRetail.Services.UserSessionService UserSessionService
@inject DataHandlerLibrary.Services.SiteServices SiteService
@inject DataHandlerLibrary.Services.TillServices TillService
@using DataHandlerLibrary.Models


<div class="row m-4 justify-content-center">
    <div class="col-md-12">
        <div class="d-flex gap-2 mb-2">
        <div class="col-md-4">
               <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToSalesDashboard()">
                    <div class="thumb">
                        <img src="images/icons/finance_mode_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="Sales Report"/>
                     </div>
                    <div class="Content">
                        <h4 class="title">
                        <a href="#">Sales Reports</a>
                        </h4>
                        <p>View comprehensive sales reports</p>
                    </div>
                </div>
        </div>

        <div class="col-md-4">
               <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToTodaysSales()">
                    <div class="thumb">
                        <img src="images/icons/today_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="Today's Sales"/>
                     </div>
                    <div class="Content">
                        <h4 class="title">
                        <a href="#">Sales Report</a>
                        </h4>
                        <p>View today's sales summary</p>
                    </div>
                </div>
        </div>

         <div class="col-md-4">
               <div class="Card-box">
                    <div class="thumb">
                        <img src="images/icons/finance_mode_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="Sales Report"/>
                     </div>
                    <div class="Content">
                        <h4 class="title">
                        <a href="#">Inventory Management</a>
                        </h4>
                        <p>View, manage and order stocks</p>
                    </div>
                </div>
        </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="d-flex gap-2 mb-2">
            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToDayLogSales()">
                    <div class="thumb">
                        <img src="images/icons/calendar_month_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="Current DayLog Sales" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Current DayLog</a>
                        </h4>
                        <p>View current daylog sales</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="OpenDrawer">
                    <div class="thumb">
                        <img src="images/icons/finance_mode_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="Open Drawer" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Open Drawer</a>
                        </h4>
                        <p>Till drawer opens</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="Card-box">
                    <div class="thumb">
                        <img src="images/icons/finance_mode_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="History" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">History</a>
                        </h4>
                        <p>View and manage: receipts, day end reports</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="Card-box">
                    <div class="thumb">
                        <img src="images/icons/finance_mode_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="Promotion" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Promotion</a>
                        </h4>
                        <p>View manage promotions</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



@code {
    private void NavigateToSalesDashboard()
    {
        NavigationManager.NavigateTo("/salesdashboard");
    }

    private void NavigateToTodaysSales()
    {
        NavigationManager.NavigateTo("/salesdashboard?filter=today");
    }

    private void NavigateToDayLogSales()
    {
        NavigationManager.NavigateTo("/salesdashboard?isDayLog=true");
    }

    private async Task OpenDrawer()
    {
        try
        {
            // Open the till drawer using printer service
            PrinterService.OpenDrawer();

            // Get current user, site, and till information
            var currentUser = UserSessionService.CurrentUser;
            var currentSite = await SiteService.GetFirstSiteRecord();
            var currentTill = await TillService.GetFirstTillRecord();

            // Create drawer log entry
            var drawerLog = new DrawerLog()
            {
                OpenedById = currentUser?.User_ID??1,
                DrawerOpenDateTime = DateTime.UtcNow,
                Site_Id = currentSite?.Site_Id,
                Till_Id = currentTill?.Till_Id,
                Created_By_Id = currentUser?.User_ID,
                Last_Modified_By_Id = currentUser?.User_ID,
                Date_Created = DateTime.UtcNow,
                Last_Modified = DateTime.UtcNow
            };

            // Insert the drawer log into the database
            await DrawerLogService.AddAsync(drawerLog);
        }
        catch (Exception ex)
        {
            // Handle any errors (you might want to show a toast or alert)
            Console.WriteLine($"Error opening drawer: {ex.Message}");
        }
    }
}
