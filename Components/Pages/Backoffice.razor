@page "/backoffice"
@inject NavigationManager NavigationManager
@inject DataHandlerLibrary.Interfaces.IPrinterService PrinterService
@inject DataHandlerLibrary.Services.DrawerLogServices DrawerLogService
@inject EposRetail.Services.UserSessionService UserSessionService
@inject DataHandlerLibrary.Services.SiteServices SiteService
@inject DataHandlerLibrary.Services.TillServices TillService
@using DataHandlerLibrary.Models


<div class="row m-4 justify-content-center">
    <div class="col-md-12">
        <div class="d-flex gap-2 mb-2">
            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToDayLogSales()">
                    <div class="thumb">
                        <img src="images/icons/svg/calendar_month_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Current DayLog Sales" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Today's Sales</a>
                        </h4>
                        <p>View Today's sales, x-read, Day End</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToShiftDashboard()">
                    <div class="thumb">
                        <img src="images/icons/svg/schedule_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Shift Sales" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Shift Sales</a>
                        </h4>
                        <p>View current shift sales and analytics</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToInventoryManagement()">
                    <div class="thumb">
                        <img src="images/icons/svg/inventory_2_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Inventory Management" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Inventory Management</a>
                        </h4>
                        <p>View, manage and order stocks</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToDepartmentManagement()">
                    <div class="thumb">
                        <img src="images/icons/svg/category_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Department Management" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Department Management</a>
                        </h4>
                        <p>Manage departments and products</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="d-flex gap-2 mb-2">
            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="OpenDrawer">
                    <div class="thumb">
                        <img src="images/icons/svg/finance_mode_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Open Drawer" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Open Drawer</a>
                        </h4>
                        <p>Till drawer opens</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToHistory()">
                    <div class="thumb">
                        <img src="images/icons/svg/history_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="History" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">History</a>
                        </h4>
                        <p>View and manage: receipts, day end reports</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="Card-box">
                    <div class="thumb">
                        <img src="images/icons/svg/finance_mode_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Promotion" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Promotion</a>
                        </h4>
                        <p>View manage promotions</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToExpiryManagement()">
                    <div class="thumb">
                        <img src="images/icons/svg/schedule_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Expiry Management" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Expiry Products</a>
                        </h4>
                        <p>Manage expiring and expired products</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-12">
        <div class="d-flex gap-2 mb-2">
            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToStockRefill()">
                    <div class="thumb">
                        <img src="images/icons/svg/inventory_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Stock Refill" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Stock Refill</a>
                        </h4>
                        <p>Manage products needing refill</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="Card-box" style="cursor: pointer;" @onclick="() => NavigateToBusinessManagement()">
                    <div class="thumb">
                        <img src="images/icons/svg/business_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt="Business Management" />
                    </div>
                    <div class="Content">
                        <h4 class="title">
                            <a href="#">Business Management</a>
                        </h4>
                        <p>Manage sites, users, and settings</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private void NavigateToSalesDashboard()
    {
        NavigationManager.NavigateTo("/salesdashboard");
    }

    private void NavigateToTodaysSales()
    {
        NavigationManager.NavigateTo("/salesdashboard?filter=today");
    }

    private void NavigateToShiftDashboard()
    {
        NavigationManager.NavigateTo("/shift-dashboard");
    }

    private void NavigateToInventoryManagement()
    {
        NavigationManager.NavigateTo("/inventory-management");
    }

    private void NavigateToDayLogSales()
    {
        NavigationManager.NavigateTo("/salesdashboard?isDayLog=true");
    }

    private void NavigateToHistory()
    {
        NavigationManager.NavigateTo("/history");
    }
    
    private void NavigateToDepartmentManagement()
    {
        NavigationManager.NavigateTo("/department-management");
    }

    private void NavigateToExpiryManagement()
    {
        NavigationManager.NavigateTo("/expiry-management");
    }

    private void NavigateToBusinessManagement()
    {
        NavigationManager.NavigateTo("/business-management");
    }

    private void NavigateToStockRefill()
    {
        NavigationManager.NavigateTo("/stock-refill");
    }

    private async Task OpenDrawer()
    {
        try
        {
            // Open the till drawer using printer service
            PrinterService.OpenDrawer();

            // Get current user, site, and till information
            var currentUser = UserSessionService.CurrentUser;
            var currentSite = await SiteService.GetFirstSiteRecord();
            var currentTill = await TillService.GetFirstTillRecord();

            // Create drawer log entry
            var drawerLog = new DrawerLog()
            {
                OpenedById = currentUser?.User_ID ?? 1,
                DrawerOpenDateTime = DateTime.UtcNow,
                Site_Id = currentSite?.Site_Id,
                Till_Id = currentTill?.Till_Id,
                Created_By_Id = currentUser?.User_ID,
                Last_Modified_By_Id = currentUser?.User_ID,
                Date_Created = DateTime.UtcNow,
                Last_Modified = DateTime.UtcNow
            };

            // Insert the drawer log into the database
            await DrawerLogService.AddAsync(drawerLog);
        }
        catch (Exception ex)
        {
            // Handle any errors (you might want to show a toast or alert)
            Console.WriteLine($"Error opening drawer: {ex.Message}");
        }
    }
}
